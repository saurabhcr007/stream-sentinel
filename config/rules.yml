# =============================================================================
# Stream Sentinel – Detection Rules
# =============================================================================
# This file is loaded at startup. To reload, restart the Flink job or use
# savepoint + re-submit.
#
# Rule types:
#   rate        – fires when events per key exceed 'threshold' within
#                 'windowSeconds'
#   threshold   – fires when 'field' value exceeds 'threshold'
#   statistical – fires when 'field' value deviates from moving average
#                 by more than deviationFactor × σ
# =============================================================================

rules:
  # --- Rate spike: more than 5 events per userId in 10 seconds ---
  - name: high_rate
    type: rate
    keyField: userId
    windowSeconds: 10
    threshold: 5

  # --- Threshold: transaction amount > 10,000 ---
  - name: high_amount
    type: threshold
    field: amount
    threshold: 10000

  # --- Statistical outlier: amount deviates from moving average ---
  - name: unusual_amount
    type: statistical
    field: amount
    windowSize: 20
    deviationFactor: 2.5
    threshold: 0
